---
title: "BA-Pred: Graph Neural Network 기반 Protein-Ligand Binding Affinity 예측"
date: 2026-02-20 15:00:00 +0900
categories: [Research, Drug Discovery]
tags: [gnn, binding-affinity, casp16, protein-ligand, deep-learning]
math: true
---

## Overview

**BA-Pred**는 Graph Neural Network(GNN)을 활용하여 단백질-리간드 간 결합 친화도(binding affinity, pKd)를 예측하는 모델입니다. **CASP16 ligand affinity prediction 부문에서 2위**를 달성했습니다.

> GitHub: [eightmm/BA-Pred](https://github.com/eightmm/BA-Pred)
{: .prompt-info }

## 핵심 아이디어

약물이 단백질에 얼마나 강하게 결합하는지를 예측하는 것은 신약 개발의 핵심 과제입니다. BA-Pred는 이 문제를 **세 가지 그래프**로 분리하여 접근합니다:

| 그래프 | 설명 | 역할 |
|--------|------|------|
| **Protein Graph** | 리간드 주변 8Å 내 단백질 포켓 | 결합 부위의 구조적 특성 학습 |
| **Ligand Graph** | 리간드 분자 구조 | 약물 분자의 화학적 특성 학습 |
| **Complex Graph** | 단백질-리간드 간 5Å 내 상호작용 | 결합 인터페이스의 상호작용 학습 |

이 분리된 구조 덕분에 단백질과 리간드 각각의 화학적 특성을 독립적으로 학습한 뒤, 상호작용 그래프를 통해 결합 메커니즘을 포착합니다.

## 모델 구조

### Feature Encoding

각 원자 노드는 **57차원** 벡터로 표현됩니다:

- 주기율표 위치 (주기 5d + 족 18d)
- 원자 종류 (C, O, N, S, P 등 11종)
- 결합 차수, 수소 개수, 혼성 궤도
- 방향족성, 고리 멤버십, 전기음성도

분자 내 엣지(공유결합)는 **13차원**으로, 분자 간 엣지(비공유 상호작용)는 **25차원**으로 인코딩합니다. 특히 분자 간 엣지에는 Gaussian distance kernel(15d)과 SMARTS 기반 pharmacophore feature(10d: 수소결합, 소수성 상호작용 등)를 포함합니다.

### GraphGPS Architecture

각 그래프는 **6개의 GraphGPS 레이어**를 통과합니다. 하나의 GraphGPS 레이어는 다음 세 모듈로 구성됩니다:

```
Input → GatedGCN-LSPE → Multi-Head Attention → MLP → Output
         (local)           (global)            (transform)
```

1. **GatedGCN-LSPE**: Gated mechanism으로 이웃 노드의 기여도를 적응적으로 조절하며, Laplacian Spectral Positional Encoding으로 그래프 구조 정보를 보존합니다.

2. **Multi-Head Attention** (4 heads): 그래프 내 장거리 의존성을 포착합니다.

3. **MLP**: BatchNorm + GELU 활성화 + 잔차 연결로 특성을 변환합니다.

### Gating Mechanism

GatedGCN의 핵심은 적응적 엣지 가중치입니다:

$$\hat{\eta}_{ij} = B_1 h_i + B_2 h_j + B_3 e_{ij}$$

$$\sigma_{ij} = \frac{\text{sigmoid}(\hat{\eta}_{ij})}{\sum_{k \in \mathcal{N}(j)} \text{sigmoid}(\hat{\eta}_{kj})}$$

이 normalized gating을 통해 각 이웃 원자가 중심 원자에 미치는 영향을 학습합니다.

### Output Head

리간드 원자에 대해 sum pooling을 수행한 뒤, MLP regression head를 통해 **단일 pKd 값**을 출력합니다.

```
Ligand atoms → Sum Pooling → Linear → BN → ELU → Dropout → Linear → pKd
```

모델 전체 파라미터는 약 **70M**입니다.

## 사용법

### 설치

```bash
pip install bapred
```

### 추론

```bash
python run_inference.py -r protein.pdb -l ligands.sdf -o results.csv
```

```python
from bapred.inference import inference

inference(
    protein_pdb="protein.pdb",
    ligand_file="ligands.sdf",
    output="results.csv",
    batch_size=128,
    device="cuda"
)
```

### 출력 예시

```
Name         pKd      Kcal/mol
ligands_0    6.1033   -8.3209
ligands_1    5.6892   -7.7563
ligands_11   7.4962   -10.2200
```

## CASP16 결과

CASP16(Critical Assessment of protein Structure Prediction)은 단백질 구조 예측 분야의 가장 권위 있는 국제 대회입니다. BA-Pred는 ligand affinity prediction 부문에서 **2위**를 기록했습니다.

## 기술적 특징 요약

- **Multi-graph 접근**: 단백질/리간드/복합체를 분리하여 각각의 특성을 독립적으로 학습
- **Pharmacophore-aware features**: SMARTS 패턴 기반 수소결합, 소수성 상호작용 등 화학적 상호작용을 명시적으로 인코딩
- **GraphGPS 하이브리드**: GatedGCN(local) + Attention(global) 결합으로 다양한 스케일의 정보 포착
- **Robust 파이프라인**: PDB, SDF, MOL2, PDBQT 등 다양한 입력 포맷 지원, 오류 분자 자동 처리
