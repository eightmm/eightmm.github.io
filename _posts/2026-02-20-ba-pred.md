---
title: "BA-Pred: Multi-Graph GNN for Protein-Ligand Binding Affinity Prediction"
date: 2026-02-20 10:00:00 +0900
categories: [Projects, Protein-Ligand]
tags: [gnn, binding-affinity, protein-ligand, graph-neural-network]
math: true
---

> GitHub: [eightmm/BA-Pred](https://github.com/eightmm/BA-Pred) \| `pip install bapred`
{: .prompt-info }

## Overview

**BA-Pred**는 단백질-리간드 복합체의 binding affinity(pKd)를 예측하는 Graph Neural Network 모델이다. 단백질, 리간드, 복합체를 **세 개의 독립적인 그래프**로 분리하여 각각의 화학적 특성을 학습한 뒤, 상호작용 패턴을 통합하는 multi-graph 구조를 사용한다.

## Model Architecture

### Three-Graph Representation

하나의 복합체를 세 가지 그래프로 분해한다:

| Graph | 구성 | Cutoff |
|-------|------|--------|
| **Protein Graph** | 리간드 주변 단백질 포켓의 원자 | 8Å |
| **Ligand Graph** | 리간드 분자의 원자와 공유결합 | - |
| **Complex Graph** | 단백질-리간드 간 비공유 상호작용 | 5Å |

이 분리를 통해 단백질과 리간드의 내부 구조를 독립적으로 인코딩하고, 복합체 그래프에서 결합 인터페이스의 상호작용만을 명시적으로 모델링한다.

### Node & Edge Features

**Node features (57D)**: 주기율표 위치(period 5D + group 18D), 원자 종류(11D), 결합 차수(7D), 수소 개수(5D), 혼성 궤도(6D), 방향족성, 고리, 전기음성도 등

**Intra-molecular edges (13D)**: 결합 유형(4D), 입체화학(6D), 고리/공액/회전 가능 여부(3D)

**Inter-molecular edges (25D)**:
- **Distance features (15D)**: Gaussian RBF kernel ($1.5^x$, $x \in [0, 14]$)
- **Interaction features (10D)**: SMARTS 기반 수소결합 donor/acceptor, 전자 donor/acceptor, 소수성 상호작용

### GraphGPS Layers

세 그래프 각각 **6개의 GraphGPS 레이어**를 통과한다. 하나의 레이어는 세 모듈로 구성된다:

**1. GatedGCN-LSPE** (Local message passing)

$$\hat{\eta}_{ij} = B_1 h_i + B_2 h_j + B_3 e_{ij}$$

$$\sigma_{ij} = \frac{\text{sigmoid}(\hat{\eta}_{ij})}{\sum_{k \in \mathcal{N}(j)} \text{sigmoid}(\hat{\eta}_{kj})}$$

Gating mechanism으로 이웃 원자의 기여도를 적응적으로 조절한다. LSPE(Laplacian Spectral Positional Encoding, 20D)는 레이어를 통과하며 함께 업데이트되어 그래프 구조 정보를 보존한다.

**2. Multi-Head Attention** (4 heads): 그래프 내 장거리 의존성 포착

**3. MLP**: BatchNorm + GELU + residual connection

### Output Head

리간드 원자에 대해 sum pooling → MLP regression head (Linear → BN → ELU → Dropout(0.15) → Linear)로 단일 pKd 값을 출력한다.

```
Model Parameters: ~70M
Embedding Dimension: 256
GNN Layers: 6 per block (18 total)
```

## Usage

```bash
pip install bapred

python run_inference.py -r protein.pdb -l ligands.sdf -o results.csv
```

```python
from bapred.inference import inference

inference(
    protein_pdb="protein.pdb",
    ligand_file="ligands.sdf",
    output="results.csv",
    batch_size=128,
    device="cuda"
)
```

### Output

```
Name         pKd      Kcal/mol
ligands_0    6.1033   -8.3209
ligands_1    5.6892   -7.7563
```

## Key Design Choices

- **Multi-graph 분리**: 단백질/리간드 내부 구조와 상호작용을 독립적으로 학습하여 artificial coupling 방지
- **Pharmacophore-aware edges**: SMARTS 패턴으로 수소결합, 소수성 상호작용 등을 명시적으로 인코딩
- **GatedGCN + Attention 하이브리드**: Local message passing과 global attention을 결합하여 다양한 스케일의 정보 포착
- **다양한 입력 포맷 지원**: PDB, SDF, MOL2, PDBQT, DLG
